name: Semantic release

on:
  workflow_call:
    inputs:
      checkout-repo:
        required: false
        type: boolean
        default: false

jobs:
  semantic-release:
    name: Semantic Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        if: inputs.checkout-repo
        with:
          fetch-depth: 0
      - name: Semantic release
        id: release
        uses: cycjimmy/semantic-release-action@v3
      - name: Major branch
        if: steps.release.outputs.new_release_published == 'true'
        shell: bash
        run: |
          echo "Updating branch: v${{ steps.release.outputs.new_release_major_version }}"
          git branch -f v${{ steps.release.outputs.new_release_major_version }}
          git push -f origin v${{ steps.release.outputs.new_release_major_version }}
